<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>marble.html</title>
    <script type="text/javascript"
            src = "simpleGame.js"></script>
    <script type="text/javascript">
    var game;
    var ball;
    var goal;
    var accel;

    Ball = function(){
        tBall = new Sprite(game, "img/redBall.png", 25, 25);
        tBall.setSpeed(0);
        tBall.setPosition(100, 100);
        
        tBall.reset = function(){
            newX = Math.random() * this.cWidth;
            newY = Math.random() * this.cHeight;
            
            this.setPosition(newX, newY);            
        }; // end reset
    
        tBall.checkKeys = function(){
            //temporary function for testing
            //wow such directions
            if (keysDown[K_UP]){
                this.changeXby(-5);
            }
            
            if (keysDown[K_DOWN]){
                this.changeXby(5);
            }
            
            if (keysDown[K_LEFT]){
                this.changeYby(-5);
            }
            
            if (keysDown[K_RIGHT]){
                this.changeYby(5);
            }
        }; // end checkKeys
        
        tBall.checkAccel = function(){
            //use the accelerometer to get input
            newDX = accel.getAY();
            newDY = accel.getAX();
            
            newDX *= -3;
            newDY *= -3;
            
            ball.setDX(newDX);
            ball.setDY(newDY);
        };// end checkAccel

        tBall.checkBounds = function(){
            //ensure the ball doesn't wrap to opposite side of screen
            //when traveling past edge boundaries
            if (this.y > 1190) {
                this.y = 1190;
            }
            if (this.y < 10) {
                this.y = 10;
            }
            if (this.x < 10) {
                this.x = 10;
            }
            if (this.x > 940) {
                this.x = 940;
            }
        };
        
        return tBall;
    }; // end ball
    
    Goal = function(){
        tGoal = new Sprite(game, "img/goal.png", 50, 50);
        tGoal.setSpeed(0);
        
        tGoal.reset = function(){
            newX = Math.random() * this.cWidth;
            newY = Math.random() * this.cHeight;
            
            this.setPosition(newX, newY);
        }; // end reset
        
        tGoal.reset();
        
        return tGoal;
    }; // end goal
    
    function checkGoal(){
        if (ball.collidesWith(goal)){
            goal.reset();
        } // end if
    } // end check

    Wall = function(){
        tWall = new Sprite(game, "img/brick.png", 30, 30);
        tWall.setSpeed(0);

        tWall.reset = function(){
            this.setPosition(100, 100);
        }; // end reset

        tWall.reset();

        return tWall;
    };
    
    function init(){
        game = new Scene();
        game.setSize(950, 1200);
        ball = new Ball();
        goal = new Goal();
        wall = new Wall();
        accel = new Accel();
        
        game.start();
    } // end init
    
    function update(){
        game.clear();
        //get input from accelerometer or keyboard
        if (game.touchable){
            ball.checkAccel();            
        } else {
            ball.checkKeys();            
        }
        
        checkGoal();
        goal.update();
        wall.update();
        ball.update();
    } // end update
    
    </script>
</head>
<body onload = "init()">
    <div id = "blockCounter">
        Blocks: 10
    </div>
</body>
</html>
